<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="malbacR">
<title>malbacR: A Vignette Pertaining to Ranking BECAS • malbacR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="malbacR: A Vignette Pertaining to Ranking BECAS">
<meta property="og:description" content="malbacR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">malbacR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>malbacR: A Vignette Pertaining to Ranking BECAS</h1>
                        <h4 data-toc-skip class="author">Damon Leach,
Kelly Stratton, Lisa Bramer</h4>
            
            <h4 data-toc-skip class="date">2024-02-12</h4>
      
      
      <div class="d-none name"><code>malbacR_vignette_rank_becas.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The R package <code>malbacR</code> is a package that deals with batch
correction methods of small molecule omics data. It works in conjunction
with <code>pmartR</code>, an R package designed for preprocessing,
filtering, and analyzing multi-omics data <span class="citation">(Stratton et al. 2019; Degnan et al. 2023)</span>.</p>
<p>This outline demonstrates the use of the function
<code>rank_becas</code> inside the the <code>malbacR</code> package.
This function allows users to rank batch correction methods based on
multiple commonly used metrics, the coefficient of variation and the
distance between centroids of batch clusters from a PCA. Additionally,
we incorporate a new metric that is more robust to data that has both a
strong biological signal as well as data that may not have a strong of a
signal - the difference in R2m/R2c between the batch corrected data and
the unnormalized data.</p>
<p>First we load in the necessary libraries which is the
<code>malbacR</code> package itself and <code>pmartR</code> <span class="citation">(Degnan et al. 2023)</span> which <code>malbacR</code>
works with compatibly. Additionally, <code>ggplot2</code> is loaded for
some slight graphical manipulations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pmartr.github.io/malbacR/">malbacR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pmartR/pmartR" class="external-link">pmartR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>We load in the <code>pmart_amide</code> data set from the package
<code>malbacR</code> originally found in the package
<code>WaveICA2.0</code> <span class="citation">(Deng and Li
2022)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pmart_amide</span><span class="op">)</span></span></code></pre></div>
<p>We then run through some general pre-processing steps with the use of
functions from <code>pmartR</code> by assigning a group designation,
log2 transforming the data, and run a median centering
normalization.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pmart_amide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/group_designation.html" class="external-link">group_designation</a></span><span class="op">(</span><span class="va">pmart_amide</span>,main_effects <span class="op">=</span> <span class="st">"group"</span>,batch_id <span class="op">=</span> <span class="st">"batch"</span><span class="op">)</span></span>
<span><span class="va">pmart_amide_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/edata_transform.html" class="external-link">edata_transform</a></span><span class="op">(</span><span class="va">pmart_amide</span>,<span class="st">"log2"</span><span class="op">)</span></span>
<span><span class="va">pmart_amide_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/normalize_global.html" class="external-link">normalize_global</a></span><span class="op">(</span><span class="va">pmart_amide_log</span>,subset_fn <span class="op">=</span> <span class="st">"all"</span>,norm_fn <span class="op">=</span> <span class="st">"median"</span>,</span>
<span>                                apply_norm <span class="op">=</span> <span class="cn">TRUE</span>,backtransform <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We then run eight different BECAs using the corresponding functions
in <code>malbacR</code> using the preferred data input (i.e. log2
transformed or raw abundance values, normalized data or unnormalized
data) for each specific BECA. Missing values are imputed for BECAs that
require complete data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># range scaling</span></span>
<span><span class="va">amide_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_range.html">bc_range</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amide_log</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># power scaling</span></span>
<span><span class="va">amide_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_power.html">bc_power</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amide_log</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pareto scaling</span></span>
<span><span class="va">amide_pareto</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_pareto.html">bc_pareto</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amide_log</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tiger</span></span>
<span><span class="va">tigerFilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tiger_filter.html">tiger_filter</a></span><span class="op">(</span><span class="va">pmart_amide</span>,sampletype_cname <span class="op">=</span> <span class="st">"group"</span>,test_val <span class="op">=</span> <span class="st">"QC"</span><span class="op">)</span></span>
<span><span class="va">pmart_amideFilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_tigerFilt.html">apply_tigerFilt</a></span><span class="op">(</span><span class="va">tigerFilt</span>,<span class="va">pmart_amide</span><span class="op">)</span></span>
<span><span class="va">amide_tiger_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_tiger.html">bc_tiger</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amideFilt</span>,sampletype_cname <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>                        test_val <span class="op">=</span> <span class="st">"QC"</span>,injection_cname <span class="op">=</span> <span class="st">"Injection_order"</span>,group_cname <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="va">amide_tiger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/edata_transform.html" class="external-link">edata_transform</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">amide_tiger_abundance</span>, data_scale <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># serrf</span></span>
<span><span class="va">impObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imputation.html">imputation</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amide_log</span><span class="op">)</span></span>
<span><span class="va">amide_imp_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply_imputation.html">apply_imputation</a></span><span class="op">(</span><span class="va">impObj</span>,<span class="va">pmart_amide_log</span><span class="op">)</span></span>
<span><span class="va">amide_imp_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/edata_transform.html" class="external-link">edata_transform</a></span><span class="op">(</span><span class="va">amide_imp_log</span>,<span class="st">"abundance"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">amide_serrf_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_serrf.html">bc_serrf</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">amide_imp_raw</span>,sampletype_cname <span class="op">=</span> <span class="st">"group"</span>,test_val <span class="op">=</span> <span class="st">"QC"</span>,group_cname <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="va">amide_serrf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/edata_transform.html" class="external-link">edata_transform</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">amide_serrf_abundance</span>,data_scale <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># qcrfsc</span></span>
<span><span class="va">amide_qcrfsc_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_qcrfsc.html">bc_qcrfsc</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">amide_imp_raw</span>,qc_cname <span class="op">=</span> <span class="st">"group"</span>,qc_val <span class="op">=</span> <span class="st">"QC"</span>,</span>
<span>                                    order_cname <span class="op">=</span> <span class="st">"Injection_order"</span>,group_cname <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>                                    ntree <span class="op">=</span> <span class="fl">500</span>, keep_qc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">amide_qcrfsc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/edata_transform.html" class="external-link">edata_transform</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">amide_qcrfsc_abundance</span>,data_scale <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combat</span></span>
<span><span class="va">amide_combat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_combat.html">bc_combat</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amide_norm</span>, use_groups <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># eigenMS</span></span>
<span><span class="va">amide_eigen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bc_eigenMS.html">bc_eigenMS</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pmart_amide_log</span><span class="op">)</span></span></code></pre></div>
<p>As some methods (QC-RFSC, TIGER, and SERRF) remove the QC samples in
the process, we remove those samples from the other methods as well.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qc_samples</span> <span class="op">&lt;-</span> <span class="va">pmart_amide_log</span><span class="op">$</span><span class="va">f_data</span><span class="op">$</span><span class="va">SampleID</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pmart_amide_log</span><span class="op">$</span><span class="va">f_data</span><span class="op">$</span><span class="va">group</span> <span class="op">==</span> <span class="st">"QC"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cfilt</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/custom_filter.html" class="external-link">custom_filter</a></span><span class="op">(</span><span class="va">amide_combat</span>, f_data_remove <span class="op">=</span> <span class="va">qc_samples</span><span class="op">)</span></span>
<span><span class="va">amide_combat</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/applyFilt.html" class="external-link">applyFilt</a></span><span class="op">(</span><span class="va">cfilt</span>,<span class="va">amide_combat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfilt</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/custom_filter.html" class="external-link">custom_filter</a></span><span class="op">(</span><span class="va">amide_eigen</span>, f_data_remove <span class="op">=</span> <span class="va">qc_samples</span><span class="op">)</span></span>
<span><span class="va">amide_eigen</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/applyFilt.html" class="external-link">applyFilt</a></span><span class="op">(</span><span class="va">cfilt</span>,<span class="va">amide_eigen</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfilt</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/custom_filter.html" class="external-link">custom_filter</a></span><span class="op">(</span><span class="va">amide_power</span>, f_data_remove <span class="op">=</span> <span class="va">qc_samples</span><span class="op">)</span></span>
<span><span class="va">amide_power</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/applyFilt.html" class="external-link">applyFilt</a></span><span class="op">(</span><span class="va">cfilt</span>,<span class="va">amide_power</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfilt</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/custom_filter.html" class="external-link">custom_filter</a></span><span class="op">(</span><span class="va">amide_pareto</span>, f_data_remove <span class="op">=</span> <span class="va">qc_samples</span><span class="op">)</span></span>
<span><span class="va">amide_pareto</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/applyFilt.html" class="external-link">applyFilt</a></span><span class="op">(</span><span class="va">cfilt</span>,<span class="va">amide_pareto</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfilt</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/custom_filter.html" class="external-link">custom_filter</a></span><span class="op">(</span><span class="va">amide_range</span>, f_data_remove <span class="op">=</span> <span class="va">qc_samples</span><span class="op">)</span></span>
<span><span class="va">amide_range</span> <span class="op">&lt;-</span> <span class="fu">pmartR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pmartR/man/applyFilt.html" class="external-link">applyFilt</a></span><span class="op">(</span><span class="va">cfilt</span>,<span class="va">amide_range</span><span class="op">)</span></span></code></pre></div>
<p>We then create a named list <code>becas</code> which contains the
<code>pmartR</code> objects for each of the 8 different BECAs being
compared.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">becas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Power <span class="op">=</span> <span class="va">amide_power</span>, Pareto <span class="op">=</span> <span class="va">amide_pareto</span>, Range <span class="op">=</span> <span class="va">amide_range</span>,</span>
<span>             ComBat <span class="op">=</span> <span class="va">amide_combat</span>, EigenMS <span class="op">=</span> <span class="va">amide_eigen</span>,</span>
<span>             QCRFSC <span class="op">=</span> <span class="va">amide_qcrfsc</span>, TIGER <span class="op">=</span> <span class="va">amide_tiger</span>, SERRF <span class="op">=</span> <span class="va">amide_serrf</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ranking-becas">Ranking BECAs<a class="anchor" aria-label="anchor" href="#ranking-becas"></a>
</h3>
<p>We then rank the methods with three different potential metrics: the
coefficient of variation (CV), the distance between batch clusters in a
PCA, and the difference in R2m/R2c between batch corrected data and
unnormalized data. This metric utilizes a mixed effect model for each
molecule and determines the conditional and marginal R2 values based on
the method introduced by Nakagawa and Schielzeth <span class="citation">(Nakagawa and Schielzeth 2012)</span>. It then
subtracts the ratio of the marginal R2 and the conditional R2 of the
unnormalized dataset from the ratio of the batch corrected data and
determines the median value. In general, we recommend this final metric
as it is more robust to data that has both a large biological signal as
well as to data in which there is less biological signal.</p>
<p>We rank the data using the function <code>rank_becas</code> in
<code>malbacR</code>. This function has five arguments:</p>
<ol style="list-style-type: decimal">
<li>
<code>omicsData_beca_list</code>: a named list with the
<code>pmartR</code> objects of batch corrected data</li>
<li>
<code>comparison_method</code>: a string supplying the metric used
to compare BECAs (<code>cv</code> for the coefficient of variation,
<code>distance_pca</code> for the distance between clusters of batches
in PCA, and <code>r2_diff</code> for the difference in R2m/R2c between
batch corrected data and unnormalized data)</li>
<li>
<code>batch_effect_cname</code>: a string supplying the column name
in <code>f_data</code> element of a <code>pmartR</code> object that
contains batch information for each sample</li>
<li>
<code>main_effect_cname</code>: a string supplying the column name
in <code>f_data</code> element of a <code>pmartR</code> object that
contains group/main effect information for each sample</li>
<li>
<code>omicsData_unnormalized</code>: <code>pmartR</code> object
containing the unnormalized data (this is only required if the
<code>comparison_method</code> is <code>r2_diff</code>, otherwise the
default is NULL)</li>
</ol>
<p>The output of this function is a dataframe with three columns. Each
row in the dataframe corresponds to one of the <code>pmartR</code>
objects in <code>omicsData_beca_list</code>. The first column is
<code>BECA</code> which corresponds to the names supplied to the named
list in <code>omicsData_beca_list</code>, the second column is
<code>Value</code> which is the value of the metric for the specific
batch corrected dataset, and the final column is <code>Ranking</code>
which is simply an integer from 1 to the number of datasets being
analyzed (with 1 being the best BECA based on that specific metric).</p>
<p>First, we rank the BECAs using the coefficient of variation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_rankings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank_becas.html">rank_becas</a></span><span class="op">(</span>omicsData_beca_list <span class="op">=</span> <span class="va">becas</span>, comparison_method <span class="op">=</span> <span class="st">"cv"</span>,</span>
<span>                          batch_effect_cname <span class="op">=</span> <span class="st">"batch"</span>, main_effect_cname <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="va">cv_rankings</span></span></code></pre></div>
<pre><code><span><span class="co">##      BECA  Value Ranking</span></span>
<span><span class="co">## 1   Power  7.818       1</span></span>
<span><span class="co">## 2   Range 10.529       2</span></span>
<span><span class="co">## 3 EigenMS 39.976       3</span></span>
<span><span class="co">## 4   SERRF 43.358       4</span></span>
<span><span class="co">## 5  ComBat 46.881       5</span></span>
<span><span class="co">## 6   TIGER 47.648       6</span></span>
<span><span class="co">## 7  QCRFSC 50.567       7</span></span>
<span><span class="co">## 8  Pareto 62.897       8</span></span></code></pre>
<p>Next, we rank the data based on the distance between batch clusters
in a PCA.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_rankings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank_becas.html">rank_becas</a></span><span class="op">(</span>omicsData_beca_list <span class="op">=</span> <span class="va">becas</span>, comparison_method <span class="op">=</span> <span class="st">"distance_pca"</span>,</span>
<span>                          batch_effect_cname <span class="op">=</span> <span class="st">"batch"</span>, main_effect_cname <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="va">pca_rankings</span></span></code></pre></div>
<pre><code><span><span class="co">##      BECA Value Ranking</span></span>
<span><span class="co">## 1  ComBat 0.012       1</span></span>
<span><span class="co">## 2 EigenMS 0.021       2</span></span>
<span><span class="co">## 3   SERRF 0.039       3</span></span>
<span><span class="co">## 4  QCRFSC 0.418       4</span></span>
<span><span class="co">## 5   TIGER 0.481       5</span></span>
<span><span class="co">## 6   Power 0.891       6</span></span>
<span><span class="co">## 7  Pareto 0.894       7</span></span>
<span><span class="co">## 8   Range 0.894       8</span></span></code></pre>
<p>Finally, we rank the data using the difference in R2m/R2c for batch
corrected data and unnormalized data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r2_rankings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank_becas.html">rank_becas</a></span><span class="op">(</span>omicsData_beca_list <span class="op">=</span> <span class="va">becas</span>, comparison_method <span class="op">=</span> <span class="st">"r2_diff"</span>,</span>
<span>                          batch_effect_cname <span class="op">=</span> <span class="st">"batch"</span>, main_effect_cname <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>                          omicsData_unnormalized <span class="op">=</span> <span class="va">pmart_amide_log</span><span class="op">)</span></span>
<span><span class="va">r2_rankings</span></span></code></pre></div>
<pre><code><span><span class="co">##      BECA  Value Ranking</span></span>
<span><span class="co">## 1  ComBat  0.991       1</span></span>
<span><span class="co">## 2 EigenMS  0.990       2</span></span>
<span><span class="co">## 3   SERRF  0.298       3</span></span>
<span><span class="co">## 4  QCRFSC  0.011       4</span></span>
<span><span class="co">## 5   TIGER  0.007       5</span></span>
<span><span class="co">## 6   Power -0.002       6</span></span>
<span><span class="co">## 7  Pareto -0.002       7</span></span>
<span><span class="co">## 8   Range -0.002       8</span></span></code></pre>
<p>It becomes evident that some of these metrics contradict each other.
For example, using the CV, Power Scaling becomes the preferred BECA of
choice, but it is ranked 6th by the other 2 metrics. In this scenario,
the distance between clusters and the difference in R2m/R2c have very
similar rankings as there is a strong biological signal within this
dataset. However, in scenarios where there is less signal from the main
effect, the distance between PCA clusters is likely to underperform. In
contrast, the difference in R2m/R2c is more robust to the amount of
biological signal from the data.</p>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-pmartr2" class="csl-entry">
Degnan, David J, Kelly G Stratton, Rachel Richardson, Daniel Claborne,
Evan A Martin, Nathan A Johnson, Damon Leach, Bobbie-Jo M
Webb-Robertson, and Lisa M Bramer. 2023. <span>“pmartR 2.0: A Quality
Control, Visualization, and Statistics Pipeline for Multiple Omics
Datatypes.”</span> <em>Journal of Proteome Research</em> 22 (2): 570–76.
<a href="https://doi.org/10.1021/acs.jproteome.2c00610" class="external-link">https://doi.org/10.1021/acs.jproteome.2c00610</a>.
</div>
<div id="ref-waveica_package" class="csl-entry">
Deng, Kui, and Kang Li. 2022. <em>WaveICA2.0: WaveICA 2.0</em>.
</div>
<div id="ref-r2mr2c" class="csl-entry">
Nakagawa, Shinichi, and Holger Schielzeth. 2012. <span>“A General and
Simple Method for Obtaining R2 from Generalized Linear Mixed-Effects
Models.”</span> <em>Methods in Ecology and Evolution</em> 4 (2): 133–42.
<a href="https://doi.org/10.1111/j.2041-210x.2012.00261.x" class="external-link">https://doi.org/10.1111/j.2041-210x.2012.00261.x</a>.
</div>
<div id="ref-pmartr" class="csl-entry">
Stratton, Kelly G, Bobbie-Jo M Webb-Robertson, Lee Ann McCue, Daniel
Claborne, Bryan Stanfill, Iobani Godinez, Thomas Johansen, et al. 2019.
<span>“pmartR: Quality Control and Statistics for Mass
Spectrometry-Based Biological Data.”</span> <em>Journal of Proteome
Research</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Damon Leach, Kelly Stratton, Lisa Bramer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
